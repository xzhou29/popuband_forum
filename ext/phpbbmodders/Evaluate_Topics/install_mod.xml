<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?>
<!--NOTICE: Please open this file in your web browser. If presented with a security warning, you may safely tell it to allow the blocked content.-->
<!--For security purposes, please check: http://www.phpbb.com/mods/ for the latest version of this MOD.\nAlthough MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD.\nNo support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.5.xsd">
	<header>
		<meta name="generator" content="MODX file generated with PP MODX Creator by tumba25 (online version)"/>
		<meta name="generator" content="Phpbb.ModTeam.Tools (c#)"/>
		<license><![CDATA[http://opensource.org/licenses/gpl-license.php GNU General Public License v2]]></license>
		<title lang="en"><![CDATA[Topic Evaluation/Rating]]></title>
		<description lang="en"><![CDATA[Topics can be rated and the average will be shown on the viewforum, viewtopic and searchresults]]></description>
		<author-notes lang="en"><![CDATA[After installing this Mod your users can rate topics.
You can create permissions in the ACP to define in which forums the rating should be enabled. Also you can define foreach forum how many stars should be shown for rating.
Included in this Mod are several language packs like listed below.
Support by me is also given in german. I have included two pictures of the ACP in this package. They show how the ACP look, after installing the mod and where the new options for this mod are placed.

A coding notice:
After I had a fully custom modded phpBB2 where an update from phpBB.com were very difficult, I try now to write my modifications to seperate files and only add one include in the phpBB file and a little number of one line function calls to my mod functions. This functions calls tries I to put in empty lines to do not move the default lines down. This should make updates more easy as in my phpBB 2 board ;)
If one or more files of the included mod directory already exists in your phpBB3 board directory then easily merge this files to one. The functions this files contains have unique names and all will work fine together.]]></author-notes>
		<author-group>
			<author>
				<realname><![CDATA[Rene Espenhahn]]></realname>
				<username><![CDATA[Novan]]></username>
				<homepage><![CDATA[http://www.svrider.de]]></homepage>
				<email><![CDATA[Rene@svrider.de]]></email>
			</author>
		</author-group>
		<mod-version>1.0.8</mod-version>
		<installation>
			<level>intermediate</level>
			<time>1380</time>
			<target-version>3.0.7-PL1</target-version>
		</installation>
		<history>
			<entry>
				<date>2007-12-21</date>
				<rev-version>1.0.0</rev-version>
				<changelog lang="en">
					<change><![CDATA[First stable release. No changes since RC6.]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2008-02-10</date>
				<rev-version>1.0.1</rev-version>
				<changelog lang="en">
					<change><![CDATA[Correction for validation Process]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2008-02-12</date>
				<rev-version>1.0.2</rev-version>
				<changelog lang="en">
					<change><![CDATA[A Secound small fix for validation process.]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2008-02-18</date>
				<rev-version>1.0.3</rev-version>
				<changelog lang="en">
					<change><![CDATA[A small fix in view_topic.php]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2008-02-20</date>
				<rev-version>1.0.4</rev-version>
				<changelog lang="en">
					<change><![CDATA[A Bugfix in the viewtopic.php which is delivered with this mod package]]></change>
					<change><![CDATA[A Bugfix of the Copy instruction in the ModX Manual of the Styles]]></change>
					<change><![CDATA[Spain Language pack inserted]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2008-02-21</date>
				<rev-version>1.0.5</rev-version>
				<changelog lang="en">
					<change><![CDATA[Rebuild a SQL query because of phpBB validation process]]></change>
					<change><![CDATA[phpBB Debug Error in mods/search fixed]]></change>
					<change><![CDATA[Check if evaluation is not greater then the max evaluation which are clickable in a forum.]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2008-06-13</date>
				<rev-version>1.0.6</rev-version>
				<changelog lang="en">
					<change><![CDATA[Review and update for phpBB 3.0.1]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2008-10-25</date>
				<rev-version>1.0.7a</rev-version>
				<changelog lang="en">
					<change><![CDATA[A devide by zero bugfix in acp_forums]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2008-11-15</date>
				<rev-version>1.0.7b</rev-version>
				<changelog lang="en">
					<change><![CDATA[A Bugfix that the javascript eval_mouse_click and eval_mouse_over is not defined]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2008-07-10</date>
				<rev-version>1.0.7</rev-version>
				<changelog lang="en">
					<change><![CDATA[A Bugfix if a user evaluate two times the same evaluation]]></change>
					<change><![CDATA[A Bugfix for editting the imageset in the acp]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2010-04-20</date>
				<rev-version>1.0.8</rev-version>
				<changelog lang="en">
					<change><![CDATA[phpBB 3.0.7-PL1 compatibility check. No changes to code -> 1.0.7b is compatible to phpBB 3.0.6 too.]]></change>
				</changelog>
			</entry>
		</history>
		<link-group>
			<link type="language" href="xml/ar.xml" lang="en">Arabic Language Pack</link>
			<link type="language" href="xml/de.xml" lang="en">German Language Pack</link>
			<link type="language" href="xml/es.xml" lang="en">Espa√±ol Language Pack</link>
			<link type="language" href="xml/nl.xml" lang="en">Dutch Language Pack</link>
			<link type="template" href="xml/subsilver2.xml" lang="en">Subsilver2</link>
		</link-group>
	</header>
	<action-group>
		<copy>
			<file from="root/language/en/acp/permissions_evaluation.php" to="language/en/acp/permissions_evaluation.php"/>
			<file from="root/language/en/mods/evaluation.php" to="language/en/mods/evaluation.php"/>
			<file from="root/mods/includes/acp/acp_forums.php" to="mods/includes/acp/acp_forums.php"/>
			<file from="root/mods/includes/acp/acp_styles.php" to="mods/includes/acp/acp_styles.php"/>
			<file from="root/mods/search.php" to="mods/search.php"/>
			<file from="root/mods/viewforum.php" to="mods/viewforum.php"/>
			<file from="root/mods/viewtopic.php" to="mods/viewtopic.php"/>
			<file from="root/install/install_evaluation_mod.php" to="install/install_evaluation_mod.php"/>
			<file from="root/install/uninstall_evaluation_mod.php" to="install/uninstall_evaluation_mod.php"/>
			<file from="root/styles/prosilver/template/evaluation.html" to="styles/prosilver/template/evaluation.html"/>
			<file from="root/styles/prosilver/imageset/evaluation_dark.gif" to="styles/prosilver/imageset/evaluation_dark.gif"/>
			<file from="root/styles/prosilver/imageset/evaluation_half.gif" to="styles/prosilver/imageset/evaluation_half.gif"/>
			<file from="root/styles/prosilver/imageset/evaluation_light.gif" to="styles/prosilver/imageset/evaluation_light.gif"/>
		</copy>
		<open src="search.php">
			<edit>
				<find><![CDATA[include($phpbb_root_path . 'common.' . $phpEx);]]></find>
				<action type="after-add"><![CDATA[include($phpbb_root_path . 'mods/search.' . $phpEx);]]></action>
			</edit>
			<edit>
				<find><![CDATA[$sql .= ' ORDER BY ' . $sort_by_sql[$sort_key] . ' ' . (($sort_dir == 'd') ? 'DESC' : 'ASC');]]></find>
				<action type="after-add"><![CDATA[evaluation_extend_sql($sql, $show_results);]]></action>
			</edit>
			<edit>
				<find><![CDATA[$template->assign_block_vars('searchresults', array_merge($tpl_ary, array(]]></find>
				<action type="before-add"><![CDATA[evaluation_extend_template($tpl_ary, $row);]]></action>
			</edit>
		</open>
		<open src="viewforum.php">
			<edit>
				<find><![CDATA[include($phpbb_root_path . 'includes/functions_display.' . $phpEx);]]></find>
				<action type="after-add"><![CDATA[include($phpbb_root_path . 'mods/viewforum.' . $phpEx);]]></action>
			</edit>
			<edit>
				<find><![CDATA[$sql_approved = ($auth->acl_get('m_approve', $forum_id)) ? '' : 'AND t.topic_approved = 1';]]></find>
				<action type="before-add"><![CDATA[evaluation_extend_sql();]]></action>
			</edit>
			<edit>
				<find><![CDATA['LEFT_JOIN'	=> $sql_array['LEFT_JOIN'],]]></find>
				<action type="after-add"><![CDATA['GROUP_BY'  => evaluation_extend_sql_group(),]]></action>
			</edit>
			<edit>
				<find><![CDATA['LEFT_JOIN'		=> $sql_array['LEFT_JOIN'],]]></find>
				<action type="after-add"><![CDATA['GROUP_BY'		=> evaluation_extend_sql_group(),]]></action>
			</edit>
			<edit>
				<find><![CDATA['LAST_POST_AUTHOR_FULL'		=> get_username_string('full', $row['topic_last_poster_id'], $row['topic_last_poster_name'], $row['topic_last_poster_colour']),]]></find>
				<action type="after-add"><![CDATA['EVALUATION_IMG'			=> evaluation_get_image(),]]></action>
			</edit>
		</open>
		<open src="viewtopic.php">
			<edit>
				<find><![CDATA[include($phpbb_root_path . 'includes/bbcode.' . $phpEx);]]></find>
				<action type="after-add"><![CDATA[include($phpbb_root_path . 'mods/viewtopic.' . $phpEx);]]></action>
			</edit>
			<edit>
				<find><![CDATA[// Redirect to login or to the correct post upon emailed notification links]]></find>
				<action type="before-add"><![CDATA[evaluation_display();]]></action>
			</edit>
		</open>
		<open src="adm/style/acp_forums.html">
			<edit>
				<find><![CDATA[<dl>
	<dt><label for="topics_per_page">{L_FORUM_TOPICS_PAGE}:</label><br /><span>{L_FORUM_TOPICS_PAGE_EXPLAIN}</span></dt>
	<dd><input type="text" id="topics_per_page" name="topics_per_page" value="{TOPICS_PER_PAGE}" size="4" maxlength="4" /></dd>
</dl>]]></find>
				<action type="after-add"><![CDATA[<dl>
	<dt><label for="evaluation">{L_ACP_EVALUATION}:</label><br /><span>{L_ACP_EVALUATION_EXPLAIN}</span></dt>
	<dd><input type="text" id="evaluation" name="evaluation" value="{EVALUATION_STARS}" size="4" maxlength="2" /><input type="hidden" name="evaluation_backup" value="{EVALUATION_STARS}" /></dd>
</dl>]]></action>
			</edit>
		</open>
		<open src="includes/constants.php">
			<edit>
				<find><![CDATA[// Additional constants]]></find>
				<action type="after-add"><![CDATA[define('EVALUATION_DEFAULT', 6);]]></action>
			</edit>
			<edit>
				<find><![CDATA[// Additional tables]]></find>
				<action type="after-add"><![CDATA[define('TOPICS_EVALUATION_TABLE', $table_prefix . 'topics_evaluation');]]></action>
			</edit>
		</open>
		<open src="includes/acp/acp_forums.php">
			<edit>
				<find><![CDATA[if (!defined('IN_PHPBB'))
{
	exit;
}]]></find>
				<action type="after-add"><![CDATA[include($phpbb_root_path . 'mods/includes/acp/acp_forums.' . $phpEx);]]></action>
			</edit>
			<edit>
				<find><![CDATA[$errors = $this->update_forum_data($forum_data);]]></find>
				<action type="before-add"><![CDATA[evaluation_request_data($forum_data, true);]]></action>
				<action type="after-add"><![CDATA[evaluation_update_data($forum_data, $errors);]]></action>
			</edit>
			<edit>
				<find><![CDATA[	'forum_password_confirm'=> '',
);]]></find>
				<action type="after-add"><![CDATA[evaluation_request_data($forum_data, false);]]></action>
			</edit>
			<edit>
				<find><![CDATA[if (strlen($forum_data['forum_password']) == 32)
{
	$errors[] = $user->lang['FORUM_PASSWORD_OLD'];
}]]></find>
				<action type="after-add"><![CDATA[evaluation_extend_template($forum_data);]]></action>
			</edit>
		</open>
		<open src="includes/acp/acp_styles.php">
			<edit>
				<find><![CDATA[if (!defined('IN_PHPBB'))
{
	exit;
}]]></find>
				<action type="after-add"><![CDATA[include($phpbb_root_path . 'mods/includes/acp/acp_styles.' . $phpEx);]]></action>
			</edit>
			<edit>
				<find><![CDATA[// Execute overall actions]]></find>
				<action type="before-add"><![CDATA[add_custom_images($this->imageset_keys);]]></action>
			</edit>
		</open>
		<open src="language/en/acp/styles.php">
			<edit>
				<find><![CDATA[));]]></find>
				<action type="before-add"><![CDATA['IMG_ICON_EVALUATION_HALF'  => 'Evaluation Half',
'IMG_ICON_EVALUATION_DARK'  => 'Evaluation Dark',
'IMG_ICON_EVALUATION_LIGHT' => 'Evaluation Light',]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/imageset/imageset.cfg">
			<edit>
				<find><![CDATA[img_icon_user_warn]]></find>
				<action type="after-add"><![CDATA[img_icon_evaluation_dark = evaluation_dark.gif*8*10
img_icon_evaluation_half = evaluation_half.gif*8*10
img_icon_evaluation_light = evaluation_light.gif*8*10]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/template/search_results.html">
			<edit>
				<find><![CDATA[<dt <!-- IF searchresults.TOPIC_ICON_IMG -->style="background-image: url({T_ICONS_PATH}{searchresults.TOPIC_ICON_IMG}); background-repeat: no-repeat;"<!-- ENDIF -->>]]></find>
				<action type="after-add"><![CDATA[<span class="left-box">]]></action>
			</edit>
			<edit>
				<find><![CDATA[<!-- IF searchresults.S_TOPIC_REPORTED --><a href="{searchresults.U_MCP_REPORT}">{REPORTED_IMG}</a><!-- ENDIF --><br />]]></find>
				<inline-edit>
					<inline-find><![CDATA[<br />]]></inline-find>
					<inline-action type="replace-with"><![CDATA[</span>]]></inline-action>
				</inline-edit>
				<action type="after-add"><![CDATA[<span class="right-box"><!-- IF searchresults.EVALUATION_IMG -->{searchresults.EVALUATION_IMG}<!-- ENDIF --></span>
<br clear="all"/>]]></action>
			</edit>
			<edit>
				<find><![CDATA[<dd>{L_REPLIES}: <strong>{searchresults.TOPIC_REPLIES}</strong></dd>
<dd>{L_VIEWS}: <strong>{searchresults.TOPIC_VIEWS}</strong></dd>]]></find>
				<action type="before-add"><![CDATA[<!-- IF searchresults.EVALUATION_IMG -->
	<dd>{L_TOPIC_EVALUATION}: {searchresults.EVALUATION_IMG}</dd>
<!-- ENDIF -->]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/template/viewforum_body.html">
			<edit>
				<find><![CDATA[<dt<!-- IF topicrow.TOPIC_ICON_IMG and S_TOPIC_ICONS --> style="background-image: url({T_ICONS_PATH}{topicrow.TOPIC_ICON_IMG}); background-repeat: no-repeat;"<!-- ENDIF --> title="{topicrow.TOPIC_FOLDER_IMG_ALT}"><!-- IF topicrow.S_UNREAD_TOPIC --><a href="{topicrow.U_NEWEST_POST}">{NEWEST_POST_IMG}</a> <!-- ENDIF --><a href="{topicrow.U_VIEW_TOPIC}" class="topictitle">{topicrow.TOPIC_TITLE}</a>]]></find>
				<inline-edit>
					<inline-find><![CDATA[<!-- ENDIF --> title="{topicrow.TOPIC_FOLDER_IMG_ALT}">]]></inline-find>
					<inline-action type="after-add"><![CDATA[<span class="left-box">]]></inline-action>
				</inline-edit>
			</edit>
			<edit>
				<find><![CDATA[<!-- IF topicrow.S_TOPIC_REPORTED --><a href="{topicrow.U_MCP_REPORT}">{REPORTED_IMG}</a><!-- ENDIF --><br />]]></find>
				<inline-edit>
					<inline-find><![CDATA[<br />]]></inline-find>
					<inline-action type="replace-with"><![CDATA[</span>]]></inline-action>
				</inline-edit>
				<action type="after-add"><![CDATA[<span class="right-box"><!-- IF topicrow.EVALUATION_IMG -->{topicrow.EVALUATION_IMG}<!-- ENDIF --></span>
	<br clear="all" />]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/template/viewtopic_body.html">
			<edit>
				<find><![CDATA[<!-- INCLUDE overall_header.html -->]]></find>
				<action type="after-add"><![CDATA[<!-- IF EVALUATION_STARS --><!-- INCLUDE evaluation.html --><!-- ENDIF -->]]></action>
			</edit>
			<edit>
				<find><![CDATA[<!-- IF U_VIEW_UNREAD_POST and not S_IS_BOT --><a href="{U_VIEW_UNREAD_POST}">{L_VIEW_UNREAD_POST}</a> &bull; <!-- ENDIF -->{TOTAL_POSTS}]]></find>
				<action type="before-add"><![CDATA[<!-- IF EVALUATION_IMG -->{L_EVALUATE_TOPIC}:&nbsp;{EVALUATION_IMG}&nbsp;&bull;&nbsp;<!-- ENDIF -->]]></action>
			</edit>
			<edit>
				<find><![CDATA[<!-- IF PAGINATION or TOTAL_POSTS -->
	<div class="pagination">
		{TOTAL_POSTS}]]></find>
				<inline-edit>
					<inline-find><![CDATA[{TOTAL_POSTS}]]></inline-find>
					<inline-action type="before-add"><![CDATA[<!-- IF EVALUATION_IMG -->{L_EVALUATE_TOPIC}:&nbsp;{EVALUATION_IMG}&nbsp;&bull;&nbsp;<!-- ENDIF -->]]></inline-action>
				</inline-edit>
			</edit>
		</open>
		<diy-instructions lang="en"><![CDATA[Further installation instructions:

1) Run the install script in the root/install directory. The file is called "install_evaluation_mod.php"
2) After the execution of the install script delete the install directory with the file in it.
3) Refresh in the ACP the image set ACP -> Styles -> Imagesets -> Refresh.
4) Maybe the cache files of the templates must be deleted if the evaluation items are not visible.

----------------------------------------------------------------------------------
Instructions to uninstall the mod:

Run the uninstall script in the root/install directory. The file is called "uninstall_evaluation_mod.php". 
Attention: Use the uninstall script from the right version. This might be different to the actual version.]]></diy-instructions>
	</action-group>
</mod>
